[
  {
    "path": "posts/2020-07-21-the-weather-outside-is-frightfull/",
    "title": "The weather outside is frightfull",
    "description": "National Weather Service fatality records",
    "author": [
      {
        "name": "David Fox",
        "url": {}
      }
    ],
    "date": "2021-07-21",
    "categories": [],
    "contents": "\r\nWeather fatalities.\r\nThis post was inspired by this chart tweeted out by my local NWS office. Let me say off the bat that I have a very high regard for what the National Weather Service does (put down the sharpie), but this data visualization left me a bit — unsatisfied.\r\n\r\n\r\n\r\nWanting to see if I could take a stab at doing something different, I was surprised to quickly find the data – however only available in a PDF. This seemed like a good time to work on my PDF extraction skills.\r\nThomas Mock recently outlined a method for scrapping pdf’s on his blog. I tried what he outlined - but was still getting some rough results.\r\nI also tried the {tabulizer} package as detailed here. With apologies to Thomas, this was easier - although I had so do some gyrations to deal with the table being split over two pages. Edward Tufte has been credited with the phrase “chart junk” which describes unnecessary or downright confusing “extras” added to charts, often obscuring the fact that they would be better off as a table. This NWS chart is suffering a slight case of chart junk, but I wonder if there is an equivalent phrase to capture what is going on in this table, with extra comments in what should be columns, as well as column names showing up again at the bottom of the table on the seconds page.\r\n\r\n\r\npdf = here(\"_posts/2020-07-21-the-weather-outside-is-frightfull/80years.pdf\")\r\n\r\ntable_scrape <-  extract_tables(file = pdf,\r\n                                method = \"decide\",\r\n                                output =\"matrix\")\r\n\r\n#bind_rows was being quite picky here, so rbind it is\r\njoined_table_scrape = rbind(table_scrape[[1]],table_scrape[[2]])\r\n\r\n#get the first rows for names\r\ncol_names = joined_table_scrape %>% as_tibble() %>%  slice(1)\r\n\r\n#rename the columns and drop some of the table trappings\r\nweather_df = joined_table_scrape %>%\r\n  as_tibble() %>% \r\n  set_names(col_names) %>% \r\n  slice(3:83) %>% \r\n  slice(-45)\r\n\r\n\r\n\r\nWe now have the equivalent of the PDF table, minus some of the extra bits, but there are still some comments hanging out in our data, and we have some janky column names.\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#nxtijaycaz .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#nxtijaycaz .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#nxtijaycaz .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#nxtijaycaz .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#nxtijaycaz .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#nxtijaycaz .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#nxtijaycaz .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#nxtijaycaz .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#nxtijaycaz .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#nxtijaycaz .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#nxtijaycaz .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#nxtijaycaz .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#nxtijaycaz .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#nxtijaycaz .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#nxtijaycaz .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#nxtijaycaz .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#nxtijaycaz .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#nxtijaycaz .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#nxtijaycaz .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#nxtijaycaz .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#nxtijaycaz .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#nxtijaycaz .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#nxtijaycaz .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#nxtijaycaz .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#nxtijaycaz .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#nxtijaycaz .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#nxtijaycaz .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#nxtijaycaz .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#nxtijaycaz .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#nxtijaycaz .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#nxtijaycaz .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#nxtijaycaz .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#nxtijaycaz .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#nxtijaycaz .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#nxtijaycaz .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-size: 65%;\r\n}\r\nYear\r\n      Lightning\r\n      Tornado\r\n      Flood\r\n      Hurricane\r\n      Heat\r\n      Cold\r\n      Winter\r\n      Rip Curr.\r\n      Wind\r\n      All Hazard\r\n      All Wx\r\n    1940\r\n      340\r\n      65\r\n      60\r\n      51\r\n      \r\n      \r\n      \r\n      \r\n      \r\n      \r\n      Includes\r\n    1941\r\n      388\r\n      53\r\n      47\r\n      10\r\n      \r\n      \r\n      \r\n      \r\n      \r\n      \r\n      categories\r\n    1942\r\n      372\r\n      384\r\n      68\r\n      8\r\n      \r\n      \r\n      \r\n      \r\n      \r\n      \r\n      not listed at\r\n    1943\r\n      432\r\n      58\r\n      107\r\n      16\r\n      \r\n      \r\n      \r\n      \r\n      \r\n      \r\n      right.\r\n    1944\r\n      419\r\n      275\r\n      33\r\n      64\r\n      \r\n      \r\n      \r\n      \r\n      \r\n      \r\n      \r\n    1945\r\n      268\r\n      210\r\n      91\r\n      7\r\n      \r\n      \r\n      \r\n      \r\n      \r\n      \r\n      See U.S.\r\n    \r\n\r\nI’ll use the excellent {janitor} package to clean up the column names, a little regex to get the text out of the all_events column, and then convert all columns to numeric with the new ‘across’ verb in {dplyr}.\r\n\r\n\r\nweather_cleaned = weather_df %>%\r\n  clean_names() %>% \r\n  rename(damages_millions = all_hazard, all_events = all_wx) %>% \r\n  mutate(all_events = str_remove_all(all_events, \"[:alpha:]|[:punct:]\"),\r\n         damages_millions = as.double(str_remove_all(damages_millions, \"[$|,]\"))) %>% \r\n  mutate(across(where(is.character), as.numeric)) \r\n\r\n\r\n\r\nNow that was a lot of trouble for a simple data table. First, let’s recreate the NWS chart (minus the 3D). This will require some summary stats for the - somewhat arbitrary - time periods compared.\r\n\r\n\r\nwx_2019 = weather_cleaned %>%\r\n  filter(year == 2019) %>% \r\n  mutate(year = as.character(year))\r\n\r\nwx_10year = weather_cleaned %>%\r\n  filter(year>= 2010) %>%\r\n  summarise(across(lightning:all_events, mean, na.rm = TRUE)) %>% \r\n  mutate(year = '10year_avg')\r\n\r\nwx_30year = weather_cleaned %>%\r\n  filter(year>= 1990) %>%\r\n  summarise(across(lightning:all_events, mean, na.rm = TRUE)) %>% \r\n  mutate(year = '30year_avg')\r\n\r\nwx_trends = bind_rows(wx_2019, wx_10year, wx_30year) %>%\r\n  mutate(year = factor(year, levels = c(\"30year_avg\", \"10year_avg\", \"2019\")))\r\n\r\nwx_trends_long = wx_trends %>% \r\n  select(-damages_millions, -all_events) %>% \r\n  pivot_longer(cols= - year, names_to = 'hazard', values_to='fatalities')\r\n\r\n\r\n\r\nNWS Plot recreation.\r\nI think there are a number of issues with the original chart, particularly the ordering of the time periods and the unsorted arrangement of the hazards, even the title is a bit confusing. Let’s take a stab at these. I’ll use the nice new ggplot function to offset the column names.\r\n\r\n\r\n\r\nWhile an improvement, in my opinion, I think there are some better ways to tackle this information. One thing we could do is add decade trends, rather than these averages - which are inclusive; the 30 year average includes the 10 year average. But why not use all the data? We’ll need to pivot the data to a longer, tidy format.\r\n\r\n\r\n\r\nOne way to approach this would be a faceted plot.\r\n\r\n\r\n\r\nGetting better - but how about some ridges?\r\n\r\n\r\n\r\nI think you could make an argument for either of these plots. The faceted plot shows actual trends and data points, but the ridge plot gives a better comparison between the groups and shows that most of these patterns look stochastic. However lightning and rip currents are interesting. Lightning fatalities have dropped dramatically since the 1940s. If we were to make this a per capital rate the change would be even more dramatic. Speculatively - there may be many fewer people working in the agricultural sector that might be exposed to lightening, also increased weather forecasting may be playing a role - most of us are carrying around an up to date weather forecast in our our pockets.\r\n\r\n\r\n\r\nFatalities related to rip current shows the opposite trend, a steep increase since this metric started to be measured in 2002. This increase is likely related to per capital swimming and beach going, rather than any increase in rip currents themselves. Still, be careful on the beach - I can attest from personal experience that being in a rip current is quite terrifying.\r\n\r\n\r\n\r\nWe can also take a quick look at all hazard fatalities - which have trended flat, with the exceptions of some bad years. Never the less, let’s be careful out there folks.\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/2020-07-21-the-weather-outside-is-frightfull/the-weather-outside-is-frightfull_files/figure-html5/unnamed-chunk-5-1.png",
    "last_modified": "2021-04-08T21:45:09-04:00",
    "input_file": {}
  }
]
